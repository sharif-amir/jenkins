pipeline {
    agent any
    environment {
        DIRECTORY_PATH= "The path of the code directory being fetched"
        TESTING_ENVIRONMENT= "pipeline"
        PRODUCTION_ENVIRONMENT= "Sharif"
        EMAIL_RECIPIENT= "4sharifamiri@gmail.com"
    }
    stages{
        stage("Build"){
            steps{
                echo "Build started and completed!"
                echo "Fetch the source code from the directory path specified by the environment variable"
            }
                post{
                    success{
                        mail to: "${EMAIL_RECIPIENT}",
                        subject: "Build successful",
                        body: "The build was successful."
                    }
                }
            }
        stage("Unit and integration Test"){
            steps{
                echo "Unit and integration Test started and completed!"
                echo "Running unit tests and integration tests"
            }
                post{
                    success{
                        emailext attachmentsPattern: '*.log',
                                 body: "The unit and integration tests were successful.",
                                 subject: "Unit and integration tests passed",
                                 to: "${EMAIL_RECIPIENT}"
                    }
                    failure{
                        emailext attachmentsPattern: '*.log',
                                 body: "The unit and integration tests failed.",
                                 subject: "Unit and integration tests failed",
                                 to: "${EMAIL_RECIPIENT}"
                    }
                }
        }
        stage(" Code Analysis"){
            steps{
                echo " Code Analysis started and completed!"
                echo "Check the quality of the code"
            }
        }
        stage("Security Scan"){
            steps{
                echo "Security Scan started and completed!"
                echo "Deploy the application to a testing environment specified by the environment variable"
            }
                post{
                    success{
                        emailext attachmentsPattern: '*.log',
                                 body: "The security scan was successful.",
                                 subject: "Security scan passed",
                                 to: "${EMAIL_RECIPIENT}"
                    }
                    failure{
                        emailext attachmentsPattern: '*.log',
                                 body: "The security scan failed.",
                                 subject: "Security scan failed",
                                 to: "${EMAIL_RECIPIENT}"
                    }
                }
        }
        stage("Deploy to Staging"){
            steps{
                echo "${TESTING_ENVIRONMENT}, Deploy to Staging started and completed!"
                
            }
        }
        stage("Integration Tests on Staging"){
            steps{
                echo "Integration Tests on Staging started and completed!"
                
            }
        }
        stage("Deploy to Production"){
            steps{
                echo "Deploy to Production started and completed!"
                
            }
        }
    }
}